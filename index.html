—Å–¥–µ–ª–∞–π —Å–∫–æ—Ä–æ—Å—Ç—å –∫–∞—Ä–æ–±–ª—è –±—ã—Å—Ä–µ–µ <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="yandex-games-sdk" content="1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –ó–∞—â–∏—Ç–Ω–∏–∫ | –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä—ã</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;500&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 800px;
            max-height: 600px;
            margin: 0 auto;
        }

        #game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            background: #000;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 150, 255, 0.5);
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            background: rgba(10, 20, 40, 0.9);
            text-align: center;
            padding: 20px;
            border-radius: 8px;
        }

        #menu-screen {
            display: flex;
        }

        #game-over-screen, #pause-screen {
            display: none;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 42px;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #00aaff, 0 0 20px #0088ff;
            color: #00eeff;
        }

        h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            margin-bottom: 30px;
            color: #00eeff;
        }

        .btn {
            background: linear-gradient(135deg, #00aaff 0%, #0066ff 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 18px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            margin: 10px 0;
            width: 220px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 102, 255, 0.4);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 102, 255, 0.6);
        }

        .btn:active {
            transform: translateY(1px);
        }

        #hud {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 30;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .hud-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            background: rgba(0, 0, 30, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid rgba(0, 150, 255, 0.5);
        }

        .hud-label {
            font-family: 'Orbitron', sans-serif;
            font-size: 16px;
            color: #00eeff;
        }

        .buff-indicator {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: rgba(0, 170, 255, 0.2);
            border: 2px solid #00aaff;
        }

        .buff-active {
            background: rgba(0, 255, 150, 0.3);
            border-color: #00ffaa;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            z-index: 30;
            padding: 0 20px;
        }

        .control-row {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 100, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            user-select: none;
            border: 2px solid rgba(0, 200, 255, 0.5);
            box-shadow: 0 0 10px rgba(0, 150, 255, 0.5);
            cursor: pointer;
        }

        #shoot-btn {
            background: rgba(255, 50, 50, 0.3);
            border: 2px solid rgba(255, 100, 100, 0.8);
            box-shadow: 0 0 10px rgba(255, 50, 50, 0.5);
        }

        .instructions {
            max-width: 600px;
            margin: 20px 0;
            line-height: 1.6;
            font-size: 16px;
            color: #aaccff;
        }

        .highlight {
            color: #00eeff;
            font-weight: 500;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ä–¥–µ—á–µ–∫ */
        .hearts {
            display: flex;
            gap: 5px;
        }

        .heart {
            font-size: 24px;
            color: #ff5555;
            transition: all 0.3s ease;
        }

        .heart.lost {
            color: #555;
            transform: scale(0.8);
            opacity: 0.5;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ —Å–µ—Ä–¥—Ü–∞ */
        @keyframes heartLost {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.8; }
            100% { transform: scale(0.8); opacity: 0.5; }
        }

        .heart-animate {
            animation: heartLost 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>

        <div id="hud">
            <div class="hud-item">
                <span class="hud-label">–û—á–∫–∏:</span>
                <span id="score">0</span>
            </div>
            <div class="hud-item">
                <span class="hud-label">–ñ–∏–∑–Ω–∏:</span>
                <div id="hearts" class="hearts">
                    <span class="heart">‚ù§Ô∏è</span>
                    <span class="heart">‚ù§Ô∏è</span>
                    <span class="heart">‚ù§Ô∏è</span>
                </div>
            </div>
            <div class="hud-item">
                <span class="hud-label">–õ—É—á—à–∏–π:</span>
                <span id="best-score">0</span>
            </div>
            <div id="buffs" style="display: flex; gap: 10px; margin-top: 10px;">
                <div class="buff-indicator" data-type="shield">üõ°Ô∏è</div>
                <div class="buff-indicator" data-type="rapid_fire">üî•</div>
                <div class="buff-indicator" data-type="invincible">üí´</div>
            </div>
        </div>

        <div id="controls">
            <div class="control-row">
                <div class="control-btn" id="up-btn">‚Üë</div>
                <div style="display: flex; gap: 10px;">
                    <div class="control-btn" id="left-btn">‚Üê</div>
                    <div class="control-btn" id="down-btn">‚Üì</div>
                    <div class="control-btn" id="right-btn">‚Üí</div>
                </div>
            </div>
            <div class="control-btn" id="shoot-btn">‚ö°</div>
        </div>

        <div id="menu-screen" class="screen">
            <h1>–ö–û–°–ú–ò–ß–ï–°–ö–ò–ô –ó–ê–©–ò–¢–ù–ò–ö</h1>
            <div class="instructions">
                <p>–ó–∞—â–∏—â–∞–π—Ç–µ –ó–µ–º–ª—é –æ—Ç –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤!</p>
                <p>–£ –≤–∞—Å –µ—Å—Ç—å 3 –∂–∏–∑–Ω–∏ –≤ –≤–∏–¥–µ —Å–µ—Ä–¥–µ—á–µ–∫</p>
                <p>–°–æ–±–∏—Ä–∞–π—Ç–µ –±–æ–Ω—É—Å—ã –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –∫–æ—Ä–∞–±–ª—è</p>
                <p>–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="menu-best-score">0</span></p>
            </div>
            <button id="start-btn" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>

        <div id="pause-screen" class="screen">
            <h2>–ü–ê–£–ó–ê</h2>
            <button id="resume-btn" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            <button id="menu-btn" class="btn">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>

        <div id="game-over-screen" class="screen">
            <h2>–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
            <p id="final-score">–í–∞—à —Å—á–µ—Ç: 0</p>
            <p id="best-score-display">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 0</p>
            <button id="restart-btn" class="btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            <button id="menu-btn-2" class="btn">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const GAME_STATE = {
            MENU: 0,
            PLAYING: 1,
            PAUSED: 2,
            GAME_OVER: 3
        };

        // –¢–∏–ø—ã –±–∞—Ñ–æ–≤
        const BUFF_TYPES = {
            SHIELD: 'shield',
            RAPID_FIRE: 'rapid_fire',
            INVINCIBLE: 'invincible'
        };

        // –ö–ª–∞—Å—Å—ã –∏–≥—Ä—ã
        class Vector {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }

            add(v) {
                return new Vector(this.x + v.x, this.y + v.y);
            }

            subtract(v) {
                return new Vector(this.x - v.x, this.y - v.y);
            }

            multiply(scalar) {
                return new Vector(this.x * scalar, this.y * scalar);
            }

            magnitude() {
                return Math.sqrt(this.x * this.x + this.y * this.y);
            }

            normalize() {
                const mag = this.magnitude();
                return mag === 0 ? new Vector(0, 0) : new Vector(this.x / mag, this.y / mag);
            }
        }

        class GameObject {
            constructor(position, velocity, size) {
                this.position = position;
                this.velocity = velocity;
                this.size = size;
                this.active = true;
            }

            update(deltaTime) {
                this.position = this.position.add(this.velocity.multiply(deltaTime));
            }

            draw(ctx) {
                // –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            }

            collidesWith(other) {
                const dx = this.position.x - other.position.x;
                const dy = this.position.y - other.position.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance < (this.size + other.size) / 2;
            }
        }

        class PlayerShip extends GameObject {
            constructor(game) {
                super(new Vector(game.canvas.width/2, game.canvas.height - 100), new Vector(0, 0), 30);
                this.game = game;
                this.lives = 3; // –¢—Ä–∏ –∂–∏–∑–Ω–∏ –≤–º–µ—Å—Ç–æ –∑–¥–æ—Ä–æ–≤—å—è
                this.shootCooldown = 0;
                this.shootDelay = 200; // –£–≤–µ–ª–∏—á–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å —Å—Ç—Ä–µ–ª—å–±—ã
                this.maxSpeed = 2; // –£–≤–µ–ª–∏—á–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∫–æ—Ä–∞–±–ª—è
                this.acceleration = 1; // –£–ª—É—á—à–µ–Ω–∞ –º–∞–Ω–µ–≤—Ä–µ–Ω–Ω–æ—Å—Ç—å
                this.currentSpeedX = 0;
                this.currentSpeedY = 0;
                this.friction = 0.90;
                this.shield = false;
                this.rapidFire = false;
                this.invincible = false;
                this.activeBuffs = {};
                this.invulnerableTimer = 0; // –¢–∞–π–º–µ—Ä –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞
            }

            update(deltaTime) {
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç—Ä–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
                this.currentSpeedX *= this.friction;
                this.currentSpeedY *= this.friction;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
                this.velocity = new Vector(this.currentSpeedX, this.currentSpeedY);

                super.update(deltaTime);

                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞
                const canvas = this.game.canvas;
                this.position.x = Math.max(this.size/2, Math.min(canvas.width - this.size/2, this.position.x));
                this.position.y = Math.max(this.size/2, Math.min(canvas.height - this.size/2, this.position.y));

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–∑–∞—Ä—è–¥–∫–∏
                if (this.shootCooldown > 0) {
                    this.shootCooldown -= deltaTime;
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—Ñ–æ–≤
                for (const buffType in this.activeBuffs) {
                    this.activeBuffs[buffType] -= deltaTime;
                    if (this.activeBuffs[buffType] <= 0) {
                        this.removeBuff(buffType);
                    }
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏
                if (this.invulnerableTimer > 0) {
                    this.invulnerableTimer -= deltaTime;
                }
            }

            applyBuff(type, duration) {
                this.activeBuffs[type] = duration;

                switch(type) {
                    case BUFF_TYPES.SHIELD:
                        this.shield = true;
                        break;
                    case BUFF_TYPES.RAPID_FIRE:
                        this.rapidFire = true;
                        this.shootDelay = 100; // –ï—â–µ –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–∞—è —Å—Ç—Ä–µ–ª—å–±–∞ —Å –±–∞—Ñ–æ–º
                        break;
                    case BUFF_TYPES.INVINCIBLE:
                        this.invincible = true;
                        break;
                }

                this.game.updateBuffIndicators();
            }

            removeBuff(type) {
                delete this.activeBuffs[type];

                switch(type) {
                    case BUFF_TYPES.SHIELD:
                        this.shield = false;
                        break;
                    case BUFF_TYPES.RAPID_FIRE:
                        this.rapidFire = false;
                        this.shootDelay = 200;
                        break;
                    case BUFF_TYPES.INVINCIBLE:
                        this.invincible = false;
                        break;
                }

                this.game.updateBuffIndicators();
            }

            takeDamage() {
                // –ï—Å–ª–∏ –Ω–µ—É—è–∑–≤–∏–º—ã–π –∏–ª–∏ –µ—Å—Ç—å —â–∏—Ç - –Ω–µ –ø–æ–ª—É—á–∞–µ–º —É—Ä–æ–Ω
                if (this.invulnerableTimer > 0 || this.invincible) return false;

                if (this.shield) {
                    this.shield = false;
                    this.removeBuff(BUFF_TYPES.SHIELD);
                    return false;
                }

                // –ü–æ–ª—É—á–∞–µ–º —É—Ä–æ–Ω
                this.lives--;
                this.invulnerableTimer = 2000; // 2 —Å–µ–∫—É–Ω–¥—ã –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞

                return true;
            }

            move(direction) {
                switch(direction) {
                    case 'left':
                        this.currentSpeedX = Math.max(-this.maxSpeed, this.currentSpeedX - this.acceleration);
                        break;
                    case 'right':
                        this.currentSpeedX = Math.min(this.maxSpeed, this.currentSpeedX + this.acceleration);
                        break;
                    case 'up':
                        this.currentSpeedY = Math.max(-this.maxSpeed, this.currentSpeedY - this.acceleration);
                        break;
                    case 'down':
                        this.currentSpeedY = Math.min(this.maxSpeed, this.currentSpeedY + this.acceleration);
                        break;
                }
            }

            stop(direction) {
                switch(direction) {
                    case 'left':
                    case 'right':
                        this.currentSpeedX *= this.friction;
                        if (Math.abs(this.currentSpeedX) < 0.01) this.currentSpeedX = 0;
                        break;
                    case 'up':
                    case 'down':
                        this.currentSpeedY *= this.friction;
                        if (Math.abs(this.currentSpeedY) < 0.01) this.currentSpeedY = 0;
                        break;
                }
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.position.x, this.position.y);

                // –ú–∏–≥–∞–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É—è–∑–≤–∏–º–æ—Å—Ç–∏
                if (this.invulnerableTimer > 0 && Math.floor(this.invulnerableTimer / 100) % 2 === 0) {
                    ctx.globalAlpha = 0.5;
                }

                // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å
                ctx.fillStyle = '#00aaff';
                ctx.beginPath();
                ctx.moveTo(0, -this.size / 2);
                ctx.lineTo(-this.size / 2, this.size / 2);
                ctx.lineTo(this.size / 2, this.size / 2);
                ctx.closePath();
                ctx.fill();

                // –ö–∞–±–∏–Ω–∞
                ctx.fillStyle = '#00eeff';
                ctx.beginPath();
                ctx.arc(0, 0, this.size / 4, 0, Math.PI * 2);
                ctx.fill();

                // –î–≤–∏–≥–∞—Ç–µ–ª–∏
                ctx.fillStyle = '#ff5500';
                ctx.fillRect(-this.size / 3, this.size / 2, this.size / 4, this.size / 3);
                ctx.fillRect(this.size / 6, this.size / 2, this.size / 4, this.size / 3);

                // –©–∏—Ç
                if (this.shield) {
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.7)';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size * 0.7, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // –ù–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å
                if (this.invincible) {
                    ctx.strokeStyle = 'rgba(255, 215, 0, 0.5)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size * 0.8, 0, Math.PI * 2);
                    ctx.stroke();
                }

                ctx.restore();
            }

            shoot() {
                if (this.shootCooldown <= 0) {
                    this.shootCooldown = this.shootDelay;
                    const bulletPos = new Vector(this.position.x, this.position.y - this.size/2);
                    const bulletVel = new Vector(0, -7); // –£–≤–µ–ª–∏—á–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –ø—É–ª—å
                    return new Bullet(bulletPos, bulletVel, 10); // –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä –ø—É–ª—å
                }
                return null;
            }
        }

        class Asteroid extends GameObject {
            constructor(position, velocity, size) {
                super(position, velocity, size);
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.02;
                this.vertices = [];
                this.generateShape();
            }

            generateShape() {
                const count = 8;
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2;
                    const distance = this.size / 2 * (0.7 + Math.random() * 0.3);
                    this.vertices.push({
                        x: Math.cos(angle) * distance,
                        y: Math.sin(angle) * distance
                    });
                }
            }

            update(deltaTime) {
                super.update(deltaTime);
                this.rotation += this.rotationSpeed * deltaTime;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.position.x, this.position.y);
                ctx.rotate(this.rotation);

                ctx.fillStyle = '#888888';
                ctx.beginPath();
                for (let i = 0; i < this.vertices.length; i++) {
                    const v = this.vertices[i];
                    if (i === 0) ctx.moveTo(v.x, v.y);
                    else ctx.lineTo(v.x, v.y);
                }
                ctx.closePath();
                ctx.fill();

                // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏
                ctx.fillStyle = '#666666';
                ctx.beginPath();
                ctx.arc(this.size * 0.2, -this.size * 0.2, this.size * 0.1, 0, Math.PI * 2);
                ctx.fill();

                ctx.beginPath();
                ctx.arc(-this.size * 0.3, this.size * 0.1, this.size * 0.15, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }
        }

        class Bullet extends GameObject {
            constructor(position, velocity, size) {
                super(position, velocity, size);
                this.lifeTime = 2000;
            }

            update(deltaTime) {
                super.update(deltaTime);
                this.lifeTime -= deltaTime;
                this.active = this.lifeTime > 0;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.position.x, this.position.y);

                // –õ–∞–∑–µ—Ä–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª - —É–≤–µ–ª–∏—á–µ–Ω –∏ —Å–¥–µ–ª–∞–Ω —è—Ä—á–µ
                const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, this.size);
                gradient.addColorStop(0, '#00eeff');
                gradient.addColorStop(0.5, '#00aaff');
                gradient.addColorStop(1, 'transparent');

                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#00eeff';
                ctx.fill();
                ctx.shadowBlur = 0;

                ctx.restore();
            }
        }

        class Buff extends GameObject {
            constructor(position, type) {
                const velocity = new Vector(0, 0.5);  // –£–º–µ–Ω—å—à–µ–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è –±–∞—Ñ–æ–≤
                super(position, velocity, 20);
                this.type = type;
            }

            draw(ctx) {
                ctx.save();
                ctx.translate(this.position.x, this.position.y);

                let color, symbol;
                switch(this.type) {
                    case BUFF_TYPES.SHIELD:
                        color = 'rgba(0, 200, 255, 0.8)';
                        symbol = 'üõ°Ô∏è';
                        break;
                    case BUFF_TYPES.RAPID_FIRE:
                        color = 'rgba(255, 100, 0, 0.8)';
                        symbol = 'üî•';
                        break;
                    case BUFF_TYPES.INVINCIBLE:
                        color = 'rgba(255, 215, 0, 0.8)';
                        symbol = 'üí´';
                        break;
                }

                // –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();

                // –°–∏–º–≤–æ–ª
                ctx.font = `${this.size * 1.2}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = 'white';
                ctx.fillText(symbol, 0, 0);

                // –°–≤–µ—á–µ–Ω–∏–µ
                ctx.shadowBlur = 10;
                ctx.shadowColor = color;
                ctx.fill();
                ctx.shadowBlur = 0;

                ctx.restore();
            }
        }

        class Particle extends GameObject {
            constructor(position, velocity, size, color, lifeTime) {
                super(position, velocity, size);
                this.color = color;
                this.lifeTime = lifeTime;
                this.maxLife = lifeTime;
            }

            update(deltaTime) {
                super.update(deltaTime);
                this.lifeTime -= deltaTime;
                this.active = this.lifeTime > 0;
            }

            draw(ctx) {
                const alpha = this.lifeTime / this.maxLife;
                ctx.save();
                ctx.translate(this.position.x, this.position.y);

                ctx.fillStyle = `rgba(${this.color}, ${alpha})`;
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fill();

                ctx.restore();
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –∏–≥—Ä—ã
        class SpaceDefenderGame {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.state = GAME_STATE.MENU;
                this.score = 0;
                this.bestScore = localStorage.getItem('spaceDefenderBestScore') || 0;
                this.player = null;
                this.asteroids = [];
                this.bullets = [];
                this.buffs = [];
                this.particles = [];
                this.asteroidSpawnTimer = 0;
                this.buffSpawnTimer = 0;
                this.lastTime = 0;

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());

                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                this.setupControls();

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Å—á–µ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                this.updateBestScoreDisplay();

                // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
                requestAnimationFrame((time) => this.gameLoop(time));
            }

            resizeCanvas() {
                const container = document.getElementById('game-container');
                this.canvas.width = container.clientWidth;
                this.canvas.height = container.clientHeight;
            }

            updateBestScoreDisplay() {
                document.getElementById('best-score').textContent = this.bestScore;
                document.getElementById('menu-best-score').textContent = this.bestScore;
                document.getElementById('best-score-display').textContent = `–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${this.bestScore}`;
            }

            updateBuffIndicators() {
                if (!this.player) return;

                const indicators = document.querySelectorAll('.buff-indicator');
                indicators.forEach(indicator => {
                    const type = indicator.dataset.type;
                    if (this.player.activeBuffs[type]) {
                        indicator.classList.add('buff-active');
                    } else {
                        indicator.classList.remove('buff-active');
                    }
                });
            }

            updateLivesDisplay() {
                const heartsContainer = document.getElementById('hearts');
                const hearts = heartsContainer.querySelectorAll('.heart');

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–µ—Ä–¥–µ—á–µ–∫
                for (let i = 0; i < hearts.length; i++) {
                    if (i < this.player.lives) {
                        hearts[i].classList.remove('lost', 'heart-animate');
                    } else {
                        // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ä–¥–µ—á–∫–æ –µ—â–µ –Ω–µ –±—ã–ª–æ –ø–æ—Ç–µ—Ä—è–Ω–æ
                        if (!hearts[i].classList.contains('lost')) {
                            hearts[i].classList.add('heart-animate');
                            // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
                            setTimeout(() => {
                                hearts[i].classList.remove('heart-animate');
                            }, 500);
                        }
                        hearts[i].classList.add('lost');
                    }
                }
            }

            setupControls() {
                // –ö–Ω–æ–ø–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                document.getElementById('start-btn').addEventListener('click', () => this.startGame());
                document.getElementById('restart-btn').addEventListener('click', () => this.startGame());
                document.getElementById('resume-btn').addEventListener('click', () => this.resumeGame());
                document.getElementById('menu-btn').addEventListener('click', () => this.showMenu());
                document.getElementById('menu-btn-2').addEventListener('click', () => this.showMenu());

                // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const leftBtn = document.getElementById('left-btn');
                const rightBtn = document.getElementById('right-btn');
                const upBtn = document.getElementById('up-btn');
                const downBtn = document.getElementById('down-btn');
                const shootBtn = document.getElementById('shoot-btn');

                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ü–ö
                const keys = {};

                document.addEventListener('keydown', (e) => {
                    if (this.state === GAME_STATE.PLAYING && this.player) {
                        keys[e.key] = true;

                        if (e.key === 'ArrowLeft') this.player.move('left');
                        if (e.key === 'ArrowRight') this.player.move('right');
                        if (e.key === 'ArrowUp') this.player.move('up');
                        if (e.key === 'ArrowDown') this.player.move('down');
                        if (e.key === ' ' || e.key === 'z') this.shoot();
                        if (e.key === 'Escape') this.pauseGame();
                    }
                });

                document.addEventListener('keyup', (e) => {
                    keys[e.key] = false;

                    if (this.player) {
                        if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                            this.player.stop('horizontal');
                        }
                        if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                            this.player.stop('vertical');
                        }
                    }
                });

                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
                const addTouchControl = (element, direction) => {
                    element.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        if (this.player) this.player.move(direction);
                    });

                    element.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        if (this.player) {
                            if (direction === 'left' || direction === 'right') {
                                this.player.stop('horizontal');
                            } else {
                                this.player.stop('vertical');
                            }
                        }
                    });
                };

                addTouchControl(leftBtn, 'left');
                addTouchControl(rightBtn, 'right');
                addTouchControl(upBtn, 'up');
                addTouchControl(downBtn, 'down');

                shootBtn.addEventListener('click', () => this.shoot());
                shootBtn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    this.shoot();
                });

                // –ü–∞—É–∑–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'hidden' && this.state === GAME_STATE.PLAYING) {
                        this.pauseGame();
                    }
                });
            }

            startGame() {
                this.state = GAME_STATE.PLAYING;
                this.score = 0;
                this.player = new PlayerShip(this);
                this.asteroids = [];
                this.bullets = [];
                this.buffs = [];
                this.particles = [];

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                document.getElementById('menu-screen').style.display = 'none';
                document.getElementById('game-over-screen').style.display = 'none';
                document.getElementById('pause-screen').style.display = 'none';
                document.getElementById('hud').style.display = 'flex';
                document.getElementById('controls').style.display = 'flex';

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HUD
                document.getElementById('score').textContent = this.score;
                this.updateLivesDisplay();
                this.updateBuffIndicators();
            }

            pauseGame() {
                if (this.state === GAME_STATE.PLAYING) {
                    this.state = GAME_STATE.PAUSED;
                    document.getElementById('pause-screen').style.display = 'flex';
                }
            }

            resumeGame() {
                if (this.state === GAME_STATE.PAUSED) {
                    this.state = GAME_STATE.PLAYING;
                    document.getElementById('pause-screen').style.display = 'none';
                }
            }

            gameOver() {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                if (this.score > this.bestScore) {
                    this.bestScore = this.score;
                    localStorage.setItem('spaceDefenderBestScore', this.bestScore);
                }
                this.updateBestScoreDisplay();

                this.state = GAME_STATE.GAME_OVER;
                document.getElementById('game-over-screen').style.display = 'flex';
                document.getElementById('final-score').textContent = `–í–∞—à —Å—á–µ—Ç: ${this.score}`;
                document.getElementById('hud').style.display = 'none';
                document.getElementById('controls').style.display = 'none';
            }

            showMenu() {
                this.state = GAME_STATE.MENU;
                document.getElementById('menu-screen').style.display = 'flex';
                document.getElementById('game-over-screen').style.display = 'none';
                document.getElementById('pause-screen').style.display = 'none';
                document.getElementById('hud').style.display = 'none';
                document.getElementById('controls').style.display = 'none';
            }

            shoot() {
                if (this.state === GAME_STATE.PLAYING && this.player) {
                    const bullet = this.player.shoot();
                    if (bullet) {
                        this.bullets.push(bullet);
                    }
                }
            }

            spawnAsteroid() {
                // –°–ª—É—á–∞–π–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —Å–≤–µ—Ä—Ö—É —ç–∫—Ä–∞–Ω–∞
                const x = Math.random() * this.canvas.width;
                const y = -50;

                // –°–ª—É—á–∞–π–Ω—ã–π —Ä–∞–∑–º–µ—Ä
                const size = 30 + Math.random() * 40; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤

                // –°–ª—É—á–∞–π–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–∞)
                const speed = 0.1 + Math.random() * 0.6;  // –û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã
                const angle = Math.PI/2 + (Math.random() - 0.5) * Math.PI/4;
                const velocity = new Vector(
                    Math.cos(angle) * speed,
                    Math.sin(angle) * speed
                );

                this.asteroids.push(new Asteroid(new Vector(x, y), velocity, size));
            }

            spawnBuff(position) {
                const buffTypes = Object.values(BUFF_TYPES);
                const type = buffTypes[Math.floor(Math.random() * buffTypes.length)];
                this.buffs.push(new Buff(position, type));
            }

            createExplosion(position, count, size, color) {
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 1 + Math.random() * 3;
                    const velocity = new Vector(
                        Math.cos(angle) * speed,
                        Math.sin(angle) * speed
                    );
                    const particleSize = size * (0.3 + Math.random() * 0.7);
                    const lifeTime = 500 + Math.random() * 1000;

                    this.particles.push(new Particle(
                        new Vector(position.x, position.y),
                        velocity,
                        particleSize,
                        color,
                        lifeTime
                    ));
                }
            }

            update(deltaTime) {
                if (this.state !== GAME_STATE.PLAYING) return;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
                if (this.player) {
                    this.player.update(deltaTime);

                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–∑–Ω–µ–π
                    if (this.player.lives <= 0) {
                        this.gameOver();
                        return;
                    }
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤
                this.asteroids.forEach(asteroid => asteroid.update(deltaTime));
                this.asteroids = this.asteroids.filter(a => a.active);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
                this.bullets.forEach(bullet => bullet.update(deltaTime));
                this.bullets = this.bullets.filter(b => b.active);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—Ñ–æ–≤
                this.buffs.forEach(buff => buff.update(deltaTime));
                this.buffs = this.buffs.filter(b => b.active);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
                this.particles.forEach(particle => particle.update(deltaTime));
                this.particles = this.particles.filter(p => p.active);

                // –°–ø–∞–≤–Ω –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤ - —á–∞—â–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
                this.asteroidSpawnTimer += deltaTime;
                if (this.asteroidSpawnTimer > 1000) { // –ë–æ–ª—å—à–µ –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤
                    this.spawnAsteroid();
                    this.asteroidSpawnTimer = 0;
                }

                // –°–ø–∞–≤–Ω –±–∞—Ñ–æ–≤
                this.buffSpawnTimer += deltaTime;
                if (this.buffSpawnTimer > 10000) { // –ß–∞—â–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –±–∞—Ñ—ã
                    const x = 50 + Math.random() * (this.canvas.width - 100);
                    this.spawnBuff(new Vector(x, -20));
                    this.buffSpawnTimer = 0;
                }

                // –ö–æ–ª–ª–∏–∑–∏–∏ –ø—É–ª—å —Å –∞—Å—Ç–µ—Ä–æ–∏–¥–∞–º–∏
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    for (let j = this.asteroids.length - 1; j >= 0; j--) {
                        if (this.bullets[i].collidesWith(this.asteroids[j])) {
                            this.bullets[i].active = false;
                            this.asteroids[j].active = false;

                            this.score += 10;
                            document.getElementById('score').textContent = this.score;

                            this.createExplosion(
                                this.asteroids[j].position,
                                20, // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –≤–∑—Ä—ã–≤–µ
                                6, // –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä —á–∞—Å—Ç–∏—Ü
                                '200,200,255'
                            );
                        }
                    }
                }

                // –ö–æ–ª–ª–∏–∑–∏–∏ –∏–≥—Ä–æ–∫–∞ —Å –∞—Å—Ç–µ—Ä–æ–∏–¥–∞–º–∏
                if (this.player) {
                    for (let i = this.asteroids.length - 1; i >= 0; i--) {
                        if (this.player.collidesWith(this.asteroids[i])) {
                            this.asteroids[i].active = false;

                            if (this.player.takeDamage()) {
                                this.updateLivesDisplay();
                                this.createExplosion(
                                    this.player.position,
                                    25, // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü
                                    7, // –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä
                                    '255,100,100'
                                );

                                if (this.player.lives <= 0) {
                                    this.gameOver();
                                }
                            }

                            this.createExplosion(
                                this.asteroids[i].position,
                                20, // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü
                                6, // –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä
                                '200,200,255'
                            );
                        }
                    }
                }

                // –ö–æ–ª–ª–∏–∑–∏–∏ —Å –±–∞—Ñ–∞–º–∏
                if (this.player) {
                    for (let i = this.buffs.length - 1; i >= 0; i--) {
                        if (this.player.collidesWith(this.buffs[i])) {
                            this.buffs[i].active = false;
                            this.player.applyBuff(this.buffs[i].type, 10000);

                            this.createExplosion(
                                this.buffs[i].position,
                                15, // –ë–æ–ª—å—à–µ —á–∞—Å—Ç–∏—Ü
                                4, // –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä
                                '100,255,100'
                            );
                        }
                    }
                }
            }

            draw() {
                const ctx = this.ctx;
                const canvas = this.canvas;

                // –û—á–∏—Å—Ç–∫–∞ —Ö–æ–ª—Å—Ç–∞
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Ñ–æ–Ω–∞ (–∫–æ—Å–º–æ—Å)
                ctx.fillStyle = '#000011';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∑–≤–µ–∑–¥
                ctx.fillStyle = '#ffffff';
                for (let i = 0; i < 100; i++) {
                    const x = (i * 31) % canvas.width;
                    const y = (i * 17) % canvas.height;
                    const size = (i % 3) * 0.5 + 0.5;
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fill();
                }

                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                this.asteroids.forEach(asteroid => asteroid.draw(ctx));
                this.bullets.forEach(bullet => bullet.draw(ctx));
                this.buffs.forEach(buff => buff.draw(ctx));
                this.particles.forEach(particle => particle.draw(ctx));

                if (this.player) {
                    this.player.draw(ctx);
                }

                // –†–∏—Å–æ–≤–∞–Ω–∏–µ HUD –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ
                if (this.state === GAME_STATE.PLAYING) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(10, 10, 150, 60);

                    ctx.fillStyle = '#ffffff';
                    ctx.font = '18px Orbitron';
                    ctx.fillText(`–û—á–∫–∏: ${this.score}`, 20, 40);

                    // –†–∏—Å–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–¥–µ—á–µ–∫ –Ω–∞ —Ö–æ–ª—Å—Ç–µ
                    const heartSize = 24;
                    const heartSpacing = 5;
                    const startX = 20;
                    const yPos = 65;

                    for (let i = 0; i < 3; i++) {
                        ctx.fillStyle = i < this.player.lives ? '#ff5555' : '#555555';
                        ctx.font = `${heartSize}px Arial`;
                        ctx.fillText('‚ù§Ô∏è', startX + i * (heartSize + heartSpacing), yPos);
                    }
                }
            }

            gameLoop(time) {
                const deltaTime = time - this.lastTime || 16;
                this.lastTime = time;

                this.update(deltaTime);
                this.draw();

                requestAnimationFrame((t) => this.gameLoop(t));
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = () => {
            new SpaceDefenderGame();
        };
    </script>
</body>
</html>
